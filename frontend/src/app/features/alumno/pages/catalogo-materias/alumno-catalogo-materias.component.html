<p-toast></p-toast>

<p-button
  label="Volver"
  icon="pi pi-arrow-left"
  class="mb-4"
  (onClick)="goBack()"
></p-button>

<h1 class="text-2xl font-semibold mb-1">Catálogo de materias</h1>
@if (carrera()) {
  <p class="mb-4 text-gray-600">Carrera: {{ carrera()!.nombre }}</p>
}

@if (loading()) {
  <p>Cargando...</p>
} @else if (error()) {
  <p class="text-red-600">{{ error() }}</p>
} @else {
  @if (materias().length === 0) {
    <p>No hay materias activas disponibles en tu carrera.</p>
  } @else {
    <div class="space-y-3">
      @for (m of materias(); track m.materia_id) {
        <div
          class="rounded-lg border p-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"
        >
          <div class="space-y-1">
            <div class="font-medium">{{ m.materia_nombre }}</div>
            <div class="text-sm text-gray-600">
              Estado: {{ estadoLabel(m) }}
            </div>
            @if (m.inscripcion?.anio || m.inscripcion?.periodo) {
              <div class="text-sm text-gray-600">
                Año: {{ m.inscripcion?.anio ?? "-" }} · Período:
                {{ m.inscripcion?.periodo ?? "-" }}
              </div>
            }
          </div>

          <p-button
            label="Solicitar inscripción"
            icon="pi pi-send"
            [disabled]="
              !puedeSolicitar(m) || requestingMateriaId() === m.materia_id
            "
            [loading]="requestingMateriaId() === m.materia_id"
            (onClick)="solicitarInscripcion(m)"
          ></p-button>
        </div>
      }
    </div>
  }
}
